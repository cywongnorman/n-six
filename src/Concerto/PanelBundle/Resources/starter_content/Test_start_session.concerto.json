{
    "version": "5.0.beta.5.3",
    "collection": [
        {
            "class_name": "Test",
            "id": 3,
            "name": "source_start_session",
            "accessibility": 2,
            "archived": "0",
            "visibility": 2,
            "type": 0,
            "code": "library(digest)\n\nif(is.null(template_def) || is.na(template_def) || template_def == \"\") {\n  decoded_template_def = fromJSON(concerto.var.get(\"template_def\"))\n} else {\n  decoded_template_def = fromJSON(template_def)\n}\n\ngetContent = function(login_form) {\n  content = login_form$paragraph\n\n  if(!is.na(type) && type == \"table\") {\n    login_control = concerto.template.join(templateId=login_form$form_field_input, params=list(id=\"login\",name=\"login\",type=\"text\",value=\"\"))\n    password_control = concerto.template.join(templateId=login_form$form_field_input, params=list(id=\"password\",name=\"password\",type=\"password\",value=\"\"))\n    login = concerto.template.join(templateId=login_form$form_field, params=list(id=\"login\",label=\"login\",classes=\"\",control=login_control))\n    password = concerto.template.join(templateId=login_form$form_field, params=list(id=\"password\",label=\"password\",classes=\"\",control=password_control))\n    content = paste0(content, login, password)\n  }\n\n  return(content)\n}\n\nauthorizeUser = function(response) {\n  print(paste0(\"authorizing user: \",response$login))\n  ub = fromJSON(user_bank)\n\n  if(!is.na(type) && type == \"table\") {\n    if(ub$table_type == \"direct\") {\n      users = ub$direct_table\n      if(length(users) > 0) {\n        for(i in 1:length(users)) {\n          user = users[[i]]\n          hashed_pass = response$password\n          if(user$encryption != \"plain\") {\n            hashed_pass = digest(hashed_pass, user$encryption, serialize=F)\n          }\n          if(user$login == response$login && user$password == hashed_pass && user$enabled == 1) {\n            rm(users)\n            return(user)\n          }\n        }\n      }\n      rm(users)\n    } \n    if(ub$table_type == \"default\") {\n      users = concerto.table.query(\"SELECT * FROM default_user_table WHERE data_set_id = '{{data_set_id}}'\", list(\n        data_set_id = dbEscapeStrings(concerto$connection, toString(ub$data_set_id))\n      ))\n      if(dim(users)[1] > 0) {\n        for(i in 1:dim(users)[1]) {\n          user = as.list(users[i,])\n          hashed_pass = response$password\n          if(user$encryption != \"plain\") {\n            hashed_pass = digest(hashed_pass, user$encryption, serialize=F)\n          }\n          if(user$login == response$login && user$password == hashed_pass && user$enabled == 1) {\n            rm(users)\n            return(user)\n          }\n        }\n      }\n      rm(users)\n    } \n    if(ub$table_type == \"custom\") {\n      users = concerto.table.query(\"SELECT * FROM {{table}} WHERE {{data_set_id_column}} = '{{data_set_id}}'\", list(\n        table=ub$custom_table$table, \n        data_set_id_column=ub$custom_table$columns$data_set_id, \n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id))\n      ))\n      if(dim(users)[1] > 0) {\n        for(i in 1:dim(users)[1]) {\n          user = as.list(users[i,])\n          hashed_pass = response$password\n          if(user$encryption != \"plain\") {\n            hashed_pass = digest(hashed_pass, user$encryption, serialize=F)\n          }\n          if(user$login == response$login && user$password == hashed_pass && user$enabled == 1) {\n            rm(users)\n            return(user)\n          }\n        }\n      }\n      rm(users)\n    }\n  }\n  return(NULL)\n}\n\ncreateSession = function(user) {\n  sb = fromJSON(session_bank)\n  user_id = NULL\n  if(!is.null(user)) { user_id = user$id }\n\n  if(sb$table_type == \"default\") {\n    concerto.table.query(\"INSERT INTO default_session_table (internal_id, test_id, user_id, last_activity_time, started_time, finished) VALUES ('{{internal_id}}', {{test_id}}, '{{user_id}}', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 0)\", list(\n      internal_id=concerto$session$id, \n      test_id=concerto$mainTest$id, \n      user_id=user_id\n    ))\n    return(as.list(concerto.table.query(\"SELECT * FROM default_session_table WHERE id={{id}}\", params=list(id=concerto.table.lastInsertId()))[1,]))\n  } \n  if(sb$table_type == \"custom\") {\n    concerto.table.query(\"INSERT INTO {{table}} ({{iternal_id_column}}, {{test_id_column}}, {{user_id_column}}, {{last_activity_time_column}}, {{started_time_column}}, {{finished_column}}) VALUES ('{{internal_id}}', {{test_id}}, '{{user_id}}', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 0)\", list(\n      table=sb$custom_table$table, \n      iternal_id_column=sb$custom_table$columns$internal_id, \n      internal_id=concerto$session$id, \n      test_id_column=sb$custom_table$columns$test_id, \n      test_id=concerto$mainTest$id, \n      user_id_column=sb$custom_table$columns$user_id, \n      user_id=user_id,\n      last_activity_time_column=sb$custom_table$columns$last_activity_time,\n      started_time_column=sb$custom_table$columns$started_time,\n      finished_column=sb$custom_table$columns$finished\n    ))\n    return(as.list(concerto.table.query(\"SELECT * FROM {{table}} WHERE id={{id}}\", params=list(table=sb$custom_table$table, id=concerto.table.lastInsertId()))[1,]))\n  }\n}\n\nresumeSession = function(user) {\n  sb = fromJSON(session_bank)\n  user_id = NULL\n  if(!is.null(user)) { user_id = user$id }\n  \n  table = \"default_session_table\"\n  test_id_column = \"test_id\"\n  user_id_column = \"user_id\"\n  internal_id_column = \"internal_id\"\n  last_activity_time_column = \"last_activity_time\"\n  finished_column = \"finished\"\n  if(sb$table_type == \"custom\") {\n    table = sb$custom_table$table\n    test_id_column = sb$custom_table$columns$test_id\n    user_id_column = sb$custom_table$columns$user_id\n    internal_id_column = sb$custom_table$columns$internal_id\n    last_activity_time_column = sb$custom_table$columns$last_activity_time\n    finished_column = sb$custom_table$columns$finished\n  }\n\n  session = concerto.table.query(\"SELECT * FROM {{table}} WHERE {{test_id_column}} = {{test_id}} AND {{user_id_column}} = '{{user_id}}' AND {{finished_column}} = 0 ORDER BY id DESC\", list(\n      table=table, \n      test_id_column=test_id_column, \n      test_id=concerto$mainTest$id, \n      user_id_column=user_id_column, \n      user_id=user_id,\n      finished_column=finished_column\n  ), n=1)\n  if(dim(session)[1] == 0) {\n    return(NULL)\n  }\n  session = as.list(session)\n  session$previous_internal_id = session$internal_id\n  session$internal_id = concerto$session$id\n  \n  time_limit = as.numeric(resume_session_time_limit)\n  if(time_limit > 0) {\n  \ttime_diff = as.numeric(Sys.time()) - as.numeric(strptime(session$last_activity_time, \"%Y-%m-%d %H:%M:%S\"))\n    if(time_diff > time_limit) {\n      print(\"session resume time limit exceeded\")\n      return(NULL)\n    }\n  }\n  \n  concerto.table.query(\"UPDATE {{table}} SET {{internal_id_column}}='{{internal_id}}', {{last_activity_time_column}}=CURRENT_TIMESTAMP WHERE id={{id}}\", list(\n    table=table,\n    internal_id_column=internal_id_column,\n    internal_id=concerto$session$id,\n    id=session$id,\n    last_activity_time_column=last_activity_time_column\n  ))\n  \n  return(session)\n}\n\ndoesLoginExists = function(login) {\n  ub = fromJSON(user_bank)\n\n  if(!is.na(type) && type == \"table\") {\n    if(ub$table_type == \"default\") {\n      users = concerto.table.query(\"SELECT * FROM default_user_table WHERE data_set_id = '{{data_set_id}}' AND login = '{{login}}'\", list(\n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        login=dbEscapeStrings(concerto$connection, toString(login))\n      ))\n      if(dim(users)[1] > 0) {\n        return(TRUE)\n      }\n    } \n    if(ub$table_type == \"custom\") {\n      users = concerto.table.query(\"SELECT * FROM {{table}} WHERE {{data_set_id_column}} = '{{data_set_id}}' AND {{login_column}} = '{{login}}'\", list(\n        table=ub$custom_table$table, \n        data_set_id_column=ub$custom_table$columns$data_set_id, \n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        login_column=ub$custom_table$columns$login, \n        login=dbEscapeStrings(concerto$connection, toString(login))\n      ))\n      if(dim(users)[1] > 0) {\n        return(TRUE)\n      }\n    }\n  }\n  return(FALSE)\n}\n\ncreateNewUser = function(login, password, email, enabled) {\n  print(paste0(\"creating new user: \",login))\n  ub = fromJSON(user_bank)\n  encryption = \"sha1\"\n\n  if(!is.na(type) && type == \"table\") {\n    if(ub$table_type == \"default\") {\n      users = concerto.table.query(\"INSERT INTO default_user_table (data_set_id, login, password, encryption, email, enabled) VALUES ('{{data_set_id}}', '{{login}}', '{{password}}', '{{encryption}}', '{{email}}', '{{enabled}}')\", list(\n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        login=dbEscapeStrings(concerto$connection, toString(login)),\n        password=dbEscapeStrings(concerto$connection, toString(digest(password, encryption, serialize=F))),\n        encryption=dbEscapeStrings(concerto$connection, toString(encryption)),\n        email=dbEscapeStrings(concerto$connection, toString(email)),\n        enabled=dbEscapeStrings(concerto$connection, toString(enabled))\n      ))\n    } \n    if(ub$table_type == \"custom\") {\n      users = concerto.table.query(\"INSERT INTO {{table}} ({{data_set_id_column}}, {{login_column}}, {{password_column}}, {{encryption_column}}, {{email_column}}, {{enabled_column}}) VALUES ('{{data_set_id}}', '{{login}}', '{{password}}', '{{encryption}}', '{{email}}', '{{enabled}}')\", list(\n        table=ub$custom_table$name, \n        data_set_id_column=ub$custom_table$columns$data_set_id, \n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        login_column=ub$custom_table$columns$login, \n        login=dbEscapeStrings(concerto$connection, toString(login)),\n        password_column=ub$custom_table$columns$password, \n        password=dbEscapeStrings(concerto$connection, toString(digest(password, encryption, serialize=F))),\n        encryption_column=ub$custom_table$columns$encryption, \n        encryption=dbEscapeStrings(concerto$connection, toString(encryption)),\n        email_column=ub$custom_table$columns$email, \n        email=dbEscapeStrings(concerto$connection, toString(email)),\n        enabled_column=ub$custom_table$columns$enabled, \n        enabled=dbEscapeStrings(concerto$connection, toString(enabled))\n      ))\n    }\n    return(concerto.table.lastInsertId())\n  }\n  return(NULL)\n}\n\nsendConfirmationMail = function(uid, email, smtp_host, smtp_port, sender, subject, paragraph, url, template){\n  library(mailR)\n\n  url = concerto.template.insertParams(url, params=list(ecuid=uid))\n  recipients = c(email)\n  body = concerto.template.join(templateId=template,params=list(url=url,paragraph=paragraph))\n\n  send.mail(\n    from = sender,\n    to = recipients,\n    subject = subject,\n    body = body,\n    smtp = list(host.name = smtp_host, port = smtp_port),\n    html = TRUE, \n    inline = TRUE,\n    authenticate = FALSE,\n    send = TRUE\n  )\n}\n\nenableUser = function(uid) {\n  ub = fromJSON(user_bank)\n\n  if(!is.na(type) && type == \"table\") {\n    if(ub$table_type == \"default\") {\n      users = concerto.table.query(\"UPDATE default_user_table SET enabled='{{enabled}}' WHERE data_set_id='{{data_set_id}}' AND id={{id}}\", list(\n        enabled=1,\n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        id=uid\n      ))\n    } \n    if(ub$table_type == \"custom\") {\n      users = concerto.table.query(\"UPDATE {{table}} SET {{enabled_column}}='{{enabled}}' WHERE {{data_set_id_column}}='{{data_set_id}}' AND id={{id}}'\", list(\n        table=ub$custom_table$table, \n        enabled_column=ub$custom_table$columns$enabled, \n        enabled=1,\n        data_set_id_column=ub$custom_table$columns$data_set_id, \n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        id=uid\n      ))\n    }\n  }\n}\n\nregistration = fromJSON(registration)\nregistration_form = fromJSON(registration_form)\n#email confirmation\nif(!is.na(ecuid) && !is.null(ecuid) && ecuid != \"\"){\n  enableUser(ecuid)\n  email_conf_success_page = fromJSON(email_conf_success_page)\n  concerto.template.show(decoded_template_def$layout, params=list(\n    header=decoded_template_def$header, \n    title=email_conf_success_page$title, \n    content=email_conf_success_page$content, \n    warning_msg=\"\", \n    buttons=\"\",\n    footer=decoded_template_def$footer\n  ))  \n}\n\nuser = NULL\nif(!is.na(type) && type==\"table\") {\n  email_confirmation_on = FALSE\n  login_form = fromJSON(login_form)\n  buttons = concerto.template.join(templateId=login_form$buttons_template,params=list(\n    label_login=login_form$login_button_label,\n    label_register=login_form$register_button_label,\n    show_register= if(registration_enabled == \"1\") {\"true\"} else {\"false\"}\n  ))\n  warning_msg = \"\"\n  response = NULL\n  while(T) {\n    content = getContent(login_form)\n    response = concerto.template.show(decoded_template_def$layout, params=list(\n      header=decoded_template_def$header, \n      title=login_form$title, \n      content=content, \n      warning_msg=warning_msg, \n      buttons=buttons,\n      footer=decoded_template_def$footer\n    ))  \n    if(response$buttonPressed == \"login\") {\n      user = authorizeUser(response)\n      if(is.null(user)) {\n        warning_msg = concerto.template.join(templateId=login_form$alert_template,params=list(alert=login_form$failed_alert))\n      } else {\n        break\n      }\n    }\n    if(response$buttonPressed == \"register\") {\n      reg_warning_msg = \"\"\n      result = NULL\n      while(T) {\n        result = concerto.test.run(registration$form_test, params=list(\n          template=decoded_template_def$layout,\n          header=decoded_template_def$header,\n          title=registration_form$title, \n          paragraph=registration_form$paragraph,\n          footer=decoded_template_def$footer,\n          form=toJSON(\n            list(\n              list(name=\"login\", definition=list(type=\"singleline\"), label=registration_form$login_label, validation=\"login!=''\", alert=registration_form$login_alert),\n              list(name=\"password\", definition=list(type=\"password\"), label=registration_form$password_label, validation=\"password!=''\", alert=registration_form$password_alert),\n              list(name=\"password_confirmation\", definition=list(type=\"password\"), label=registration_form$password_confirmation_label, validation=\"password==password_confirmation\", alert=registration_form$password_confirmation_alert),\n              list(name=\"email\", definition=list(type=\"singleline\"), label=registration_form$email_label, validation=\"email!=''\", alert=registration_form$email_alert)\n            )\n          ),\n          warning_msg = reg_warning_msg,\n          button_label=registration_form$register_button_label\n        ));\n\n        if(!doesLoginExists(result$response$login)) {\n          break\n        } else {\n          reg_warning_msg = registration_form$login_exists_alert\n        }\n      }\n      email_confirmation_on = registration$email_confirmation == \"1\"\n      enabled = \"1\"\n      if(email_confirmation_on) { \n        enabled == \"0\" \n      }\n      uid = createNewUser(result$response$login, result$response$password, result$response$email, enabled)\n      if(email_confirmation_on) { \n        email_conf_request_page = fromJSON(email_conf_request_page)\n        email_conf = fromJSON(email_confirmation)\n        sendConfirmationMail(uid, result$response$email, registration$ec_smtp$host, registration$ec_smtp$port, email_conf$sender, email_conf$subject, email_conf$paragraph, registration$ec_link, email_conf$template)\n\n        concerto.template.show(decoded_template_def$layout, params=list(\n          header=decoded_template_def$header, \n          title=email_conf_request_page$title, \n          content=email_conf_request_page$content, \n          warning_msg=\"\", \n          buttons=\"\",\n          footer=decoded_template_def$footer\n        )) \n      }\n      user = authorizeUser(list(login=result$response$login, password=result$response$password))\n      break\n    }\n  }\n}\nif(!is.na(type) && type==\"direct\") {\n  print(\"using direct user...\")\n  user = direct_user\n}\n\nsession = NULL\nif(resume_session == \"1\") {\n  session = resumeSession(user)\n  if(!is.null(session)) {\n    print(\"resuming session...\")\n    hash = concerto.table.query(\"SELECT hash FROM TestSession WHERE id={{id}}\", list(id=session$previous_internal_id))\n    print(hash)\n    file = gsub(concerto$session$hash, hash, concerto$sessionFile)\n    if(file.exists(file)) {\n    \tconcerto.session.restoreFlow(hash)\n    } else {\n      \tprint(\"session resume file not found\")\n      \tsession = NULL\n    }\n  }\n}\nif(is.null(session)) {\n  print(\"creating new session...\")\n  session = createSession(user)\n}\nprint(\"DONE\")",
            "outdated": "0",
            "description": "",
            "variables": [
                {
                    "class_name": "TestVariable",
                    "id": 25,
                    "name": "type",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 26,
                    "name": "user",
                    "type": 1,
                    "description": "<p>Returned user object list:<\/p>\n\n<ul>\n\t<li><strong>user$id<\/strong>&nbsp;- user unique id<\/li>\n\t<li><strong>user$login&nbsp;<\/strong>- user login<\/li>\n<\/ul>\n",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 27,
                    "name": "user_bank",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 28,
                    "name": "user_bank",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 29,
                    "name": "session_bank",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 30,
                    "name": "session",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 31,
                    "name": "session_bank",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 32,
                    "name": "registration",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 33,
                    "name": "ecuid",
                    "type": 0,
                    "description": "<p>Email confirmation user id<\/p>\n",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 34,
                    "name": "template_def",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 35,
                    "name": "login_form",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 36,
                    "name": "registration_enabled",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 37,
                    "name": "registration_form",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 38,
                    "name": "email_conf_request_page",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 39,
                    "name": "email_conf_success_page",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 40,
                    "name": "email_confirmation",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 41,
                    "name": "new_session",
                    "type": 2,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 42,
                    "name": "resume_session",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 43,
                    "name": "direct_user",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 3,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 44,
                    "name": "resume_session_time_limit",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 3,
                    "parentVariable": null
                }
            ],
            "sourceWizard": null,
            "sourceWizardName": null,
            "sourceWizardTest": null,
            "sourceWizardTestName": null,
            "updatedOn": "2018-05-16 18:17:07",
            "updatedBy": "",
            "nodes": [],
            "nodesConnections": [],
            "tags": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "acfe73a065bd04a8c57b00c5164766584946a115"
        },
        {
            "class_name": "TestWizard",
            "id": 3,
            "name": "start_session",
            "description": "",
            "accessibility": 2,
            "archived": "0",
            "steps": [
                {
                    "class_name": "TestWizardStep",
                    "id": 6,
                    "title": "Session",
                    "description": "<p>Session data source<\/p>\n",
                    "orderNum": 0,
                    "colsNum": 0,
                    "wizard": 3,
                    "params": [
                        {
                            "class_name": "TestWizardParam",
                            "id": 20,
                            "label": "Session bank",
                            "description": "<p>Session table definition:<\/p>\n\n<ul>\n\t<li><strong>default<\/strong>&nbsp;- uses default session table<\/li>\n\t<li><strong>custom&nbsp;<\/strong>- define your own session table<\/li>\n<\/ul>\n",
                            "hideCondition": "",
                            "type": 9,
                            "passableThroughUrl": "0",
                            "value": "{\"table_type\":\"default\",\"custom_table\":[]}",
                            "testVariable": 29,
                            "name": "session_bank",
                            "wizardStep": 6,
                            "stepTitle": "Session",
                            "order": 0,
                            "wizard": 3,
                            "definition": {
                                "placeholder": "0",
                                "fields": [
                                    {
                                        "type": "3",
                                        "name": "table_type",
                                        "label": "Type",
                                        "definition": {
                                            "options": [
                                                {
                                                    "value": "default",
                                                    "label": "default"
                                                },
                                                {
                                                    "value": "custom",
                                                    "label": "custom"
                                                }
                                            ],
                                            "defvalue": "default"
                                        },
                                        "order": 0
                                    },
                                    {
                                        "type": 12,
                                        "name": "custom_table",
                                        "label": "Table",
                                        "hideCondition": "parent.table_type != \"custom\"",
                                        "order": 1,
                                        "definition": {
                                            "placeholder": 0,
                                            "cols": [
                                                {
                                                    "name": "user_id",
                                                    "label": "User id",
                                                    "tooltip": "User id column"
                                                },
                                                {
                                                    "name": "test_id",
                                                    "label": "Test id",
                                                    "tooltip": "Test id column"
                                                },
                                                {
                                                    "name": "internal_id",
                                                    "label": "Session internal id",
                                                    "tooltip": "Session internal id column"
                                                },
                                                {
                                                    "name": "last_activity_time",
                                                    "label": "Last activity time",
                                                    "tooltip": "Last activity time column"
                                                },
                                                {
                                                    "name": "finished",
                                                    "label": "Finished",
                                                    "tooltip": "Is finished?"
                                                },
                                                {
                                                    "name": "started_time",
                                                    "label": "Started time",
                                                    "tooltip": "Started time column"
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 21,
                            "label": "Resume session?",
                            "description": "<p>If there is previous session&nbsp;available for authorised user, should it be used instead of creating a new one?<\/p>\n",
                            "hideCondition": "",
                            "type": 4,
                            "passableThroughUrl": "0",
                            "value": "0",
                            "testVariable": 42,
                            "name": "resume_session",
                            "wizardStep": 6,
                            "stepTitle": "Session",
                            "order": 1,
                            "wizard": 3,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "0"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 22,
                            "label": "Resume session time limit.",
                            "description": "<p>Resume session time limit in seconds.<br \/>\n0 for unlimited.<\/p>\n",
                            "hideCondition": "values.resume_session == \"0\"",
                            "type": 0,
                            "passableThroughUrl": "0",
                            "value": "0",
                            "testVariable": 44,
                            "name": "resume_session_time_limit",
                            "wizardStep": 6,
                            "stepTitle": "Session",
                            "order": 2,
                            "wizard": 3,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "0"
                            }
                        }
                    ]
                },
                {
                    "class_name": "TestWizardStep",
                    "id": 7,
                    "title": "Authorization",
                    "description": "<p>Authorization options<\/p>\n",
                    "orderNum": 1,
                    "colsNum": 0,
                    "wizard": 3,
                    "params": [
                        {
                            "class_name": "TestWizardParam",
                            "id": 23,
                            "label": "Type",
                            "description": "<p>Authorization type<\/p>\n\n<ul>\n\t<li><strong>user table<\/strong>&nbsp;- predefined user bank that let&#39;s users log in using login\/password combination<\/li>\n\t<li><strong>direct user<\/strong>&nbsp;- user passed by&nbsp;<strong>direct_user<\/strong>&nbsp;parameter will be used<\/li>\n<\/ul>\n",
                            "hideCondition": "",
                            "type": 3,
                            "passableThroughUrl": "0",
                            "value": "table",
                            "testVariable": 25,
                            "name": "type",
                            "wizardStep": 7,
                            "stepTitle": "Authorization",
                            "order": 0,
                            "wizard": 3,
                            "definition": {
                                "placeholder": "0",
                                "options": [
                                    {
                                        "value": "table",
                                        "label": "user table",
                                        "order": 0
                                    },
                                    {
                                        "value": "direct",
                                        "label": "direct user",
                                        "order": 1
                                    }
                                ],
                                "defvalue": "table"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 24,
                            "label": "User bank",
                            "description": "<p style=\"line-height: 20.8px;\">User bank table type:<\/p>\n\n<ul style=\"line-height: 20.8px;\">\n\t<li><strong>default&nbsp;<\/strong>- uses default Concerto table; user needs to be inserted first<\/li>\n\t<li><strong>direct<\/strong>&nbsp;- can be defined directly in wizard form<\/li>\n\t<li><strong>custom<\/strong>&nbsp;- used to define your own table that you want to use as user bank<\/li>\n<\/ul>\n",
                            "hideCondition": "values.type != \"table\"",
                            "type": 9,
                            "passableThroughUrl": "0",
                            "value": "{\"table_type\":\"default\",\"direct_table\":[],\"custom_table\":[],\"data_set_id\":null}",
                            "testVariable": 27,
                            "name": "user_bank",
                            "wizardStep": 7,
                            "stepTitle": "Authorization",
                            "order": 6,
                            "wizard": 3,
                            "definition": {
                                "placeholder": "0",
                                "fields": [
                                    {
                                        "type": "3",
                                        "name": "table_type",
                                        "label": "Table type",
                                        "definition": {
                                            "options": [
                                                {
                                                    "value": "default",
                                                    "label": "default"
                                                },
                                                {
                                                    "value": "direct",
                                                    "label": "direct"
                                                },
                                                {
                                                    "value": "custom",
                                                    "label": "custom"
                                                }
                                            ],
                                            "defvalue": "default"
                                        },
                                        "order": 0
                                    },
                                    {
                                        "type": "10",
                                        "name": "direct_table",
                                        "label": "Users",
                                        "definition": {
                                            "element": {
                                                "type": 9,
                                                "definition": {
                                                    "fields": [
                                                        {
                                                            "type": "0",
                                                            "name": "id",
                                                            "label": "Id"
                                                        },
                                                        {
                                                            "type": "0",
                                                            "name": "login",
                                                            "label": "Login"
                                                        },
                                                        {
                                                            "type": "0",
                                                            "name": "password",
                                                            "label": "Password"
                                                        },
                                                        {
                                                            "type": "3",
                                                            "name": "encryption",
                                                            "label": "Encryption",
                                                            "definition": {
                                                                "options": [
                                                                    {
                                                                        "value": "plain",
                                                                        "label": "plain"
                                                                    },
                                                                    {
                                                                        "value": "md5",
                                                                        "label": "md5"
                                                                    },
                                                                    {
                                                                        "value": "sha1",
                                                                        "label": "sha1"
                                                                    },
                                                                    {
                                                                        "value": "sha256",
                                                                        "label": "sha256"
                                                                    },
                                                                    {
                                                                        "value": "sha512",
                                                                        "label": "sha512"
                                                                    },
                                                                    {
                                                                        "value": "xxhash32",
                                                                        "label": "xxhash32"
                                                                    },
                                                                    {
                                                                        "value": "xxhash64",
                                                                        "label": "xxhash64"
                                                                    },
                                                                    {
                                                                        "value": "murmur32",
                                                                        "label": "murmur32"
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        {
                                                            "type": 0,
                                                            "name": "email",
                                                            "label": "Email",
                                                            "definition": {
                                                                "placeholder": 0
                                                            }
                                                        },
                                                        {
                                                            "type": 4,
                                                            "name": "enabled",
                                                            "label": "Enabled",
                                                            "definition": {
                                                                "placeholder": 0
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        },
                                        "hideCondition": "parent.table_type != \"direct\"",
                                        "order": 2
                                    },
                                    {
                                        "type": 12,
                                        "name": "custom_table",
                                        "label": "Custom user table",
                                        "hideCondition": "parent.table_type != \"custom\"",
                                        "definition": {
                                            "placeholder": 0,
                                            "cols": [
                                                {
                                                    "name": "login",
                                                    "label": "Login",
                                                    "tooltip": "Login column"
                                                },
                                                {
                                                    "name": "password",
                                                    "label": "Password",
                                                    "tooltip": "Password column"
                                                },
                                                {
                                                    "name": "encryption",
                                                    "label": "Encryption",
                                                    "tooltip": "Encryption column"
                                                },
                                                {
                                                    "name": "data_set_id",
                                                    "label": "Data set id",
                                                    "tooltip": "Data set id column"
                                                },
                                                {
                                                    "name": "email",
                                                    "label": "Email",
                                                    "tooltip": "Email column"
                                                },
                                                {
                                                    "name": "enabled",
                                                    "label": "Enabled",
                                                    "tooltip": "Enabled column"
                                                }
                                            ]
                                        },
                                        "order": 2
                                    },
                                    {
                                        "type": 0,
                                        "name": "data_set_id",
                                        "label": "Data set id",
                                        "definition": {
                                            "placeholder": 0
                                        },
                                        "hideCondition": "parent.table_type == \"direct\"",
                                        "order": 1
                                    }
                                ]
                            }
                        }
                    ]
                },
                {
                    "class_name": "TestWizardStep",
                    "id": 8,
                    "title": "Registration",
                    "description": "<p>Public registration settings.<\/p>\n\n<p>Public registration is only possible when&nbsp;<strong>user table&nbsp;<\/strong>is used for user authorisation.<\/p>\n",
                    "orderNum": 2,
                    "colsNum": 0,
                    "wizard": 3,
                    "params": [
                        {
                            "class_name": "TestWizardParam",
                            "id": 25,
                            "label": "Public registration",
                            "description": "",
                            "hideCondition": "values.registration_enabled == '0'",
                            "type": 9,
                            "passableThroughUrl": "0",
                            "value": "{\"email_confirmation\":\"0\",\"ec_smtp\":[],\"form_test\":\"form\",\"ec_link\":\"http:\\\/\\\/domain.com\\\/test\\\/slug?ecuid={{ecuid}}\"}",
                            "testVariable": 32,
                            "name": "registration",
                            "wizardStep": 8,
                            "stepTitle": "Registration",
                            "order": 1,
                            "wizard": 3,
                            "definition": {
                                "fields": [
                                    {
                                        "type": 4,
                                        "name": "email_confirmation",
                                        "label": "Email confirmation",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "0"
                                        },
                                        "hideCondition": "",
                                        "order": 1
                                    },
                                    {
                                        "type": 9,
                                        "name": "ec_smtp",
                                        "label": "SMTP settings",
                                        "definition": {
                                            "placeholder": 0,
                                            "fields": [
                                                {
                                                    "type": 0,
                                                    "name": "host",
                                                    "label": "SMTP host",
                                                    "definition": {
                                                        "placeholder": 0
                                                    }
                                                },
                                                {
                                                    "type": 0,
                                                    "name": "port",
                                                    "label": "SMTP port",
                                                    "definition": {
                                                        "placeholder": 0
                                                    }
                                                }
                                            ]
                                        },
                                        "hideCondition": "parent.email_confirmation == \"0\"",
                                        "order": 3
                                    },
                                    {
                                        "type": 8,
                                        "name": "form_test",
                                        "label": "Form page subtest",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "form"
                                        },
                                        "order": 0,
                                        "hideCondition": ""
                                    },
                                    {
                                        "type": 0,
                                        "name": "ec_link",
                                        "label": "Email confirmation link",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "http:\/\/domain.com\/test\/slug?ecuid={{ecuid}}"
                                        },
                                        "hideCondition": "parent.email_confirmation == \"0\"",
                                        "order": 6
                                    }
                                ]
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 26,
                            "label": "Enabled",
                            "description": "<p>Is public registration enabled?<\/p>\n",
                            "hideCondition": "",
                            "type": 4,
                            "passableThroughUrl": "0",
                            "value": "0",
                            "testVariable": 36,
                            "name": "registration_enabled",
                            "wizardStep": 8,
                            "stepTitle": "Registration",
                            "order": 0,
                            "wizard": 3,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "0"
                            }
                        }
                    ]
                },
                {
                    "class_name": "TestWizardStep",
                    "id": 9,
                    "title": "Presentation",
                    "description": "<p>Presentation layer settings.<\/p>\n",
                    "orderNum": 3,
                    "colsNum": 0,
                    "wizard": 3,
                    "params": [
                        {
                            "class_name": "TestWizardParam",
                            "id": 27,
                            "label": "Login form",
                            "description": "",
                            "hideCondition": "",
                            "type": 9,
                            "passableThroughUrl": "0",
                            "value": "{\"title\":\"DEMO TEST\",\"paragraph\":\"<p>Please log in:<\\\/p>\\n\",\"login_button_label\":\"log in\",\"failed_alert\":\"Authorization failed!\",\"form_field\":\"form_field\",\"form_field_input\":\"form_field_input\",\"buttons_template\":\"buttons_start_session_login\",\"register_button_label\":\"register\",\"alert_template\":\"form_alert\"}",
                            "testVariable": 35,
                            "name": "login_form",
                            "wizardStep": 9,
                            "stepTitle": "Presentation",
                            "order": 0,
                            "wizard": 3,
                            "definition": {
                                "fields": [
                                    {
                                        "type": 0,
                                        "name": "title",
                                        "label": "Title",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "DEMO TEST"
                                        },
                                        "order": 0
                                    },
                                    {
                                        "type": 2,
                                        "name": "paragraph",
                                        "label": "Paragraph",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "<p>Please log in:<\/p>\n"
                                        },
                                        "order": 1
                                    },
                                    {
                                        "type": 0,
                                        "name": "login_button_label",
                                        "label": "Login button label",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "log in"
                                        },
                                        "order": 7
                                    },
                                    {
                                        "type": 0,
                                        "name": "failed_alert",
                                        "label": "Failed login alert",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Authorization failed!"
                                        },
                                        "order": 3
                                    },
                                    {
                                        "type": 5,
                                        "name": "form_field",
                                        "label": "Form field container template",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "form_field"
                                        },
                                        "order": 4
                                    },
                                    {
                                        "type": 5,
                                        "name": "form_field_input",
                                        "label": "Form field input template",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "form_field_input"
                                        },
                                        "order": 5
                                    },
                                    {
                                        "type": 5,
                                        "name": "buttons_template",
                                        "label": "Form buttons template",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "buttons_start_session_login"
                                        },
                                        "order": 6
                                    },
                                    {
                                        "type": 0,
                                        "name": "register_button_label",
                                        "label": "Register button label",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "register"
                                        },
                                        "order": 8
                                    },
                                    {
                                        "type": 5,
                                        "name": "alert_template",
                                        "label": "Alert template",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "form_alert"
                                        },
                                        "order": 9
                                    }
                                ]
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 28,
                            "label": "Registration form",
                            "description": "",
                            "hideCondition": "",
                            "type": 9,
                            "passableThroughUrl": "0",
                            "value": "{\"paragraph\":\"<p>Please fill the form below:<\\\/p>\\n\",\"login_label\":\"Login\",\"login_alert\":\"Invalid login!\",\"password_label\":\"Password\",\"password_alert\":\"Invalid password!\",\"password_confirmation_label\":\"Password confirmation\",\"password_confirmation_alert\":\"Password confirmation and password doesn't match!\",\"email_label\":\"Email\",\"email_alert\":\"Invalid email!\",\"register_button_label\":\"register\",\"login_exists_alert\":\"Login already exists!\",\"title\":\"REGISTRATION\"}",
                            "testVariable": 37,
                            "name": "registration_form",
                            "wizardStep": 9,
                            "stepTitle": "Presentation",
                            "order": 1,
                            "wizard": 3,
                            "definition": {
                                "fields": [
                                    {
                                        "type": 2,
                                        "name": "paragraph",
                                        "label": "Paragraph",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "<p>Please fill the form below:<\/p>\n"
                                        },
                                        "order": 1
                                    },
                                    {
                                        "type": 0,
                                        "name": "login_label",
                                        "label": "Login label",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Login"
                                        },
                                        "order": 2
                                    },
                                    {
                                        "type": 0,
                                        "name": "login_alert",
                                        "label": "Login alert",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Invalid login!"
                                        },
                                        "order": 3
                                    },
                                    {
                                        "type": 0,
                                        "name": "password_label",
                                        "label": "Password label",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Password"
                                        },
                                        "order": 5
                                    },
                                    {
                                        "type": 0,
                                        "name": "password_alert",
                                        "label": "Password alert",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Invalid password!"
                                        },
                                        "order": 6
                                    },
                                    {
                                        "type": 0,
                                        "name": "password_confirmation_label",
                                        "label": "Password confirmation label",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Password confirmation"
                                        },
                                        "order": 7
                                    },
                                    {
                                        "type": 0,
                                        "name": "password_confirmation_alert",
                                        "label": "Password confirmation alert",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Password confirmation and password doesn't match!"
                                        },
                                        "order": 8
                                    },
                                    {
                                        "type": 0,
                                        "name": "email_label",
                                        "label": "Email label",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Email"
                                        },
                                        "order": 9
                                    },
                                    {
                                        "type": 0,
                                        "name": "email_alert",
                                        "label": "Email alert",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Invalid email!"
                                        },
                                        "order": 10
                                    },
                                    {
                                        "type": 0,
                                        "name": "register_button_label",
                                        "label": "Register button label",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "register"
                                        },
                                        "order": 11
                                    },
                                    {
                                        "type": 0,
                                        "name": "login_exists_alert",
                                        "label": "Login already exists alert",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "Login already exists!"
                                        },
                                        "order": 4
                                    },
                                    {
                                        "type": 0,
                                        "name": "title",
                                        "label": "Title",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "REGISTRATION"
                                        },
                                        "order": 0
                                    }
                                ]
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 29,
                            "label": "Email confirmation request page",
                            "description": "",
                            "hideCondition": "",
                            "type": 9,
                            "passableThroughUrl": "0",
                            "value": "{\"title\":\"EMAIL CONFIRMATION\",\"content\":\"<p>Email has been sent to your address. Please follow the link in the email to confirm your address.<\\\/p>\\n\"}",
                            "testVariable": 38,
                            "name": "email_conf_request_page",
                            "wizardStep": 9,
                            "stepTitle": "Presentation",
                            "order": 2,
                            "wizard": 3,
                            "definition": {
                                "fields": [
                                    {
                                        "type": 0,
                                        "name": "title",
                                        "label": "Title",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "EMAIL CONFIRMATION"
                                        }
                                    },
                                    {
                                        "type": 2,
                                        "name": "content",
                                        "label": "Content",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "<p>Email has been sent to your address. Please follow the link in the email to confirm your address.<\/p>\n"
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 30,
                            "label": "Email confirmation success page",
                            "description": "",
                            "hideCondition": "",
                            "type": 9,
                            "passableThroughUrl": "0",
                            "value": "{\"title\":\"EMAIL CONFIRMATION\",\"content\":\"<p>Your email address has been successfully verified. Please refresh the page to log in.<\\\/p>\\n\"}",
                            "testVariable": 39,
                            "name": "email_conf_success_page",
                            "wizardStep": 9,
                            "stepTitle": "Presentation",
                            "order": 3,
                            "wizard": 3,
                            "definition": {
                                "fields": [
                                    {
                                        "type": 0,
                                        "name": "title",
                                        "label": "Title",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "EMAIL CONFIRMATION"
                                        }
                                    },
                                    {
                                        "type": 2,
                                        "name": "content",
                                        "label": "Content",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "<p>Your email address has been successfully verified. Please refresh the page to log in.<\/p>\n"
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 31,
                            "label": "Confirmation email",
                            "description": "",
                            "hideCondition": "",
                            "type": 9,
                            "passableThroughUrl": "0",
                            "value": "{\"sender\":\"concerto@domain.com\",\"subject\":\"email confirmation\",\"paragraph\":\"<p>To verify your email address please click <a href=\\\"{{url}}\\\">HERE<\\\/a>.<\\\/p>\\n\",\"template\":\"start_session_confirmation_mail\"}",
                            "testVariable": 40,
                            "name": "email_confirmation",
                            "wizardStep": 9,
                            "stepTitle": "Presentation",
                            "order": 4,
                            "wizard": 3,
                            "definition": {
                                "fields": [
                                    {
                                        "type": 0,
                                        "name": "sender",
                                        "label": "Sender",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "concerto@domain.com"
                                        },
                                        "order": 0
                                    },
                                    {
                                        "type": 0,
                                        "name": "subject",
                                        "label": "Subject",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "email confirmation"
                                        },
                                        "order": 1
                                    },
                                    {
                                        "type": 2,
                                        "name": "paragraph",
                                        "label": "Paragraph",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "<p>To verify your email address please click <a href=\"{{url}}\">HERE<\/a>.<\/p>\n"
                                        },
                                        "order": 3
                                    },
                                    {
                                        "type": 5,
                                        "name": "template",
                                        "label": "Body template",
                                        "definition": {
                                            "placeholder": 0,
                                            "defvalue": "start_session_confirmation_mail"
                                        },
                                        "order": 2
                                    }
                                ]
                            }
                        }
                    ]
                }
            ],
            "test": 3,
            "testName": "source_start_session",
            "updatedOn": "2018-05-16 18:17:07",
            "updatedBy": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "4b14e27124336b53c1129ff842fbb915c9899c28"
        },
        {
            "class_name": "Test",
            "id": 6,
            "name": "start_session",
            "accessibility": 2,
            "archived": "0",
            "visibility": 2,
            "type": 1,
            "code": "library(digest)\n\nif(is.null(template_def) || is.na(template_def) || template_def == \"\") {\n  decoded_template_def = fromJSON(concerto.var.get(\"template_def\"))\n} else {\n  decoded_template_def = fromJSON(template_def)\n}\n\ngetContent = function(login_form) {\n  content = login_form$paragraph\n\n  if(!is.na(type) && type == \"table\") {\n    login_control = concerto.template.join(templateId=login_form$form_field_input, params=list(id=\"login\",name=\"login\",type=\"text\",value=\"\"))\n    password_control = concerto.template.join(templateId=login_form$form_field_input, params=list(id=\"password\",name=\"password\",type=\"password\",value=\"\"))\n    login = concerto.template.join(templateId=login_form$form_field, params=list(id=\"login\",label=\"login\",classes=\"\",control=login_control))\n    password = concerto.template.join(templateId=login_form$form_field, params=list(id=\"password\",label=\"password\",classes=\"\",control=password_control))\n    content = paste0(content, login, password)\n  }\n\n  return(content)\n}\n\nauthorizeUser = function(response) {\n  print(paste0(\"authorizing user: \",response$login))\n  ub = fromJSON(user_bank)\n\n  if(!is.na(type) && type == \"table\") {\n    if(ub$table_type == \"direct\") {\n      users = ub$direct_table\n      if(length(users) > 0) {\n        for(i in 1:length(users)) {\n          user = users[[i]]\n          hashed_pass = response$password\n          if(user$encryption != \"plain\") {\n            hashed_pass = digest(hashed_pass, user$encryption, serialize=F)\n          }\n          if(user$login == response$login && user$password == hashed_pass && user$enabled == 1) {\n            rm(users)\n            return(user)\n          }\n        }\n      }\n      rm(users)\n    } \n    if(ub$table_type == \"default\") {\n      users = concerto.table.query(\"SELECT * FROM default_user_table WHERE data_set_id = '{{data_set_id}}'\", list(\n        data_set_id = dbEscapeStrings(concerto$connection, toString(ub$data_set_id))\n      ))\n      if(dim(users)[1] > 0) {\n        for(i in 1:dim(users)[1]) {\n          user = as.list(users[i,])\n          hashed_pass = response$password\n          if(user$encryption != \"plain\") {\n            hashed_pass = digest(hashed_pass, user$encryption, serialize=F)\n          }\n          if(user$login == response$login && user$password == hashed_pass && user$enabled == 1) {\n            rm(users)\n            return(user)\n          }\n        }\n      }\n      rm(users)\n    } \n    if(ub$table_type == \"custom\") {\n      users = concerto.table.query(\"SELECT * FROM {{table}} WHERE {{data_set_id_column}} = '{{data_set_id}}'\", list(\n        table=ub$custom_table$table, \n        data_set_id_column=ub$custom_table$columns$data_set_id, \n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id))\n      ))\n      if(dim(users)[1] > 0) {\n        for(i in 1:dim(users)[1]) {\n          user = as.list(users[i,])\n          hashed_pass = response$password\n          if(user$encryption != \"plain\") {\n            hashed_pass = digest(hashed_pass, user$encryption, serialize=F)\n          }\n          if(user$login == response$login && user$password == hashed_pass && user$enabled == 1) {\n            rm(users)\n            return(user)\n          }\n        }\n      }\n      rm(users)\n    }\n  }\n  return(NULL)\n}\n\ncreateSession = function(user) {\n  sb = fromJSON(session_bank)\n  user_id = NULL\n  if(!is.null(user)) { user_id = user$id }\n\n  if(sb$table_type == \"default\") {\n    concerto.table.query(\"INSERT INTO default_session_table (internal_id, test_id, user_id, last_activity_time, started_time, finished) VALUES ('{{internal_id}}', {{test_id}}, '{{user_id}}', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 0)\", list(\n      internal_id=concerto$session$id, \n      test_id=concerto$mainTest$id, \n      user_id=user_id\n    ))\n    return(as.list(concerto.table.query(\"SELECT * FROM default_session_table WHERE id={{id}}\", params=list(id=concerto.table.lastInsertId()))[1,]))\n  } \n  if(sb$table_type == \"custom\") {\n    concerto.table.query(\"INSERT INTO {{table}} ({{iternal_id_column}}, {{test_id_column}}, {{user_id_column}}, {{last_activity_time_column}}, {{started_time_column}}, {{finished_column}}) VALUES ('{{internal_id}}', {{test_id}}, '{{user_id}}', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 0)\", list(\n      table=sb$custom_table$table, \n      iternal_id_column=sb$custom_table$columns$internal_id, \n      internal_id=concerto$session$id, \n      test_id_column=sb$custom_table$columns$test_id, \n      test_id=concerto$mainTest$id, \n      user_id_column=sb$custom_table$columns$user_id, \n      user_id=user_id,\n      last_activity_time_column=sb$custom_table$columns$last_activity_time,\n      started_time_column=sb$custom_table$columns$started_time,\n      finished_column=sb$custom_table$columns$finished\n    ))\n    return(as.list(concerto.table.query(\"SELECT * FROM {{table}} WHERE id={{id}}\", params=list(table=sb$custom_table$table, id=concerto.table.lastInsertId()))[1,]))\n  }\n}\n\nresumeSession = function(user) {\n  sb = fromJSON(session_bank)\n  user_id = NULL\n  if(!is.null(user)) { user_id = user$id }\n  \n  table = \"default_session_table\"\n  test_id_column = \"test_id\"\n  user_id_column = \"user_id\"\n  internal_id_column = \"internal_id\"\n  last_activity_time_column = \"last_activity_time\"\n  finished_column = \"finished\"\n  if(sb$table_type == \"custom\") {\n    table = sb$custom_table$table\n    test_id_column = sb$custom_table$columns$test_id\n    user_id_column = sb$custom_table$columns$user_id\n    internal_id_column = sb$custom_table$columns$internal_id\n    last_activity_time_column = sb$custom_table$columns$last_activity_time\n    finished_column = sb$custom_table$columns$finished\n  }\n\n  session = concerto.table.query(\"SELECT * FROM {{table}} WHERE {{test_id_column}} = {{test_id}} AND {{user_id_column}} = '{{user_id}}' AND {{finished_column}} = 0 ORDER BY id DESC\", list(\n      table=table, \n      test_id_column=test_id_column, \n      test_id=concerto$mainTest$id, \n      user_id_column=user_id_column, \n      user_id=user_id,\n      finished_column=finished_column\n  ), n=1)\n  if(dim(session)[1] == 0) {\n    return(NULL)\n  }\n  session = as.list(session)\n  session$previous_internal_id = session$internal_id\n  session$internal_id = concerto$session$id\n  \n  time_limit = as.numeric(resume_session_time_limit)\n  if(time_limit > 0) {\n  \ttime_diff = as.numeric(Sys.time()) - as.numeric(strptime(session$last_activity_time, \"%Y-%m-%d %H:%M:%S\"))\n    if(time_diff > time_limit) {\n      print(\"session resume time limit exceeded\")\n      return(NULL)\n    }\n  }\n  \n  concerto.table.query(\"UPDATE {{table}} SET {{internal_id_column}}='{{internal_id}}', {{last_activity_time_column}}=CURRENT_TIMESTAMP WHERE id={{id}}\", list(\n    table=table,\n    internal_id_column=internal_id_column,\n    internal_id=concerto$session$id,\n    id=session$id,\n    last_activity_time_column=last_activity_time_column\n  ))\n  \n  return(session)\n}\n\ndoesLoginExists = function(login) {\n  ub = fromJSON(user_bank)\n\n  if(!is.na(type) && type == \"table\") {\n    if(ub$table_type == \"default\") {\n      users = concerto.table.query(\"SELECT * FROM default_user_table WHERE data_set_id = '{{data_set_id}}' AND login = '{{login}}'\", list(\n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        login=dbEscapeStrings(concerto$connection, toString(login))\n      ))\n      if(dim(users)[1] > 0) {\n        return(TRUE)\n      }\n    } \n    if(ub$table_type == \"custom\") {\n      users = concerto.table.query(\"SELECT * FROM {{table}} WHERE {{data_set_id_column}} = '{{data_set_id}}' AND {{login_column}} = '{{login}}'\", list(\n        table=ub$custom_table$table, \n        data_set_id_column=ub$custom_table$columns$data_set_id, \n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        login_column=ub$custom_table$columns$login, \n        login=dbEscapeStrings(concerto$connection, toString(login))\n      ))\n      if(dim(users)[1] > 0) {\n        return(TRUE)\n      }\n    }\n  }\n  return(FALSE)\n}\n\ncreateNewUser = function(login, password, email, enabled) {\n  print(paste0(\"creating new user: \",login))\n  ub = fromJSON(user_bank)\n  encryption = \"sha1\"\n\n  if(!is.na(type) && type == \"table\") {\n    if(ub$table_type == \"default\") {\n      users = concerto.table.query(\"INSERT INTO default_user_table (data_set_id, login, password, encryption, email, enabled) VALUES ('{{data_set_id}}', '{{login}}', '{{password}}', '{{encryption}}', '{{email}}', '{{enabled}}')\", list(\n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        login=dbEscapeStrings(concerto$connection, toString(login)),\n        password=dbEscapeStrings(concerto$connection, toString(digest(password, encryption, serialize=F))),\n        encryption=dbEscapeStrings(concerto$connection, toString(encryption)),\n        email=dbEscapeStrings(concerto$connection, toString(email)),\n        enabled=dbEscapeStrings(concerto$connection, toString(enabled))\n      ))\n    } \n    if(ub$table_type == \"custom\") {\n      users = concerto.table.query(\"INSERT INTO {{table}} ({{data_set_id_column}}, {{login_column}}, {{password_column}}, {{encryption_column}}, {{email_column}}, {{enabled_column}}) VALUES ('{{data_set_id}}', '{{login}}', '{{password}}', '{{encryption}}', '{{email}}', '{{enabled}}')\", list(\n        table=ub$custom_table$name, \n        data_set_id_column=ub$custom_table$columns$data_set_id, \n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        login_column=ub$custom_table$columns$login, \n        login=dbEscapeStrings(concerto$connection, toString(login)),\n        password_column=ub$custom_table$columns$password, \n        password=dbEscapeStrings(concerto$connection, toString(digest(password, encryption, serialize=F))),\n        encryption_column=ub$custom_table$columns$encryption, \n        encryption=dbEscapeStrings(concerto$connection, toString(encryption)),\n        email_column=ub$custom_table$columns$email, \n        email=dbEscapeStrings(concerto$connection, toString(email)),\n        enabled_column=ub$custom_table$columns$enabled, \n        enabled=dbEscapeStrings(concerto$connection, toString(enabled))\n      ))\n    }\n    return(concerto.table.lastInsertId())\n  }\n  return(NULL)\n}\n\nsendConfirmationMail = function(uid, email, smtp_host, smtp_port, sender, subject, paragraph, url, template){\n  library(mailR)\n\n  url = concerto.template.insertParams(url, params=list(ecuid=uid))\n  recipients = c(email)\n  body = concerto.template.join(templateId=template,params=list(url=url,paragraph=paragraph))\n\n  send.mail(\n    from = sender,\n    to = recipients,\n    subject = subject,\n    body = body,\n    smtp = list(host.name = smtp_host, port = smtp_port),\n    html = TRUE, \n    inline = TRUE,\n    authenticate = FALSE,\n    send = TRUE\n  )\n}\n\nenableUser = function(uid) {\n  ub = fromJSON(user_bank)\n\n  if(!is.na(type) && type == \"table\") {\n    if(ub$table_type == \"default\") {\n      users = concerto.table.query(\"UPDATE default_user_table SET enabled='{{enabled}}' WHERE data_set_id='{{data_set_id}}' AND id={{id}}\", list(\n        enabled=1,\n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        id=uid\n      ))\n    } \n    if(ub$table_type == \"custom\") {\n      users = concerto.table.query(\"UPDATE {{table}} SET {{enabled_column}}='{{enabled}}' WHERE {{data_set_id_column}}='{{data_set_id}}' AND id={{id}}'\", list(\n        table=ub$custom_table$table, \n        enabled_column=ub$custom_table$columns$enabled, \n        enabled=1,\n        data_set_id_column=ub$custom_table$columns$data_set_id, \n        data_set_id=dbEscapeStrings(concerto$connection, toString(ub$data_set_id)),\n        id=uid\n      ))\n    }\n  }\n}\n\nregistration = fromJSON(registration)\nregistration_form = fromJSON(registration_form)\n#email confirmation\nif(!is.na(ecuid) && !is.null(ecuid) && ecuid != \"\"){\n  enableUser(ecuid)\n  email_conf_success_page = fromJSON(email_conf_success_page)\n  concerto.template.show(decoded_template_def$layout, params=list(\n    header=decoded_template_def$header, \n    title=email_conf_success_page$title, \n    content=email_conf_success_page$content, \n    warning_msg=\"\", \n    buttons=\"\",\n    footer=decoded_template_def$footer\n  ))  \n}\n\nuser = NULL\nif(!is.na(type) && type==\"table\") {\n  email_confirmation_on = FALSE\n  login_form = fromJSON(login_form)\n  buttons = concerto.template.join(templateId=login_form$buttons_template,params=list(\n    label_login=login_form$login_button_label,\n    label_register=login_form$register_button_label,\n    show_register= if(registration_enabled == \"1\") {\"true\"} else {\"false\"}\n  ))\n  warning_msg = \"\"\n  response = NULL\n  while(T) {\n    content = getContent(login_form)\n    response = concerto.template.show(decoded_template_def$layout, params=list(\n      header=decoded_template_def$header, \n      title=login_form$title, \n      content=content, \n      warning_msg=warning_msg, \n      buttons=buttons,\n      footer=decoded_template_def$footer\n    ))  \n    if(response$buttonPressed == \"login\") {\n      user = authorizeUser(response)\n      if(is.null(user)) {\n        warning_msg = concerto.template.join(templateId=login_form$alert_template,params=list(alert=login_form$failed_alert))\n      } else {\n        break\n      }\n    }\n    if(response$buttonPressed == \"register\") {\n      reg_warning_msg = \"\"\n      result = NULL\n      while(T) {\n        result = concerto.test.run(registration$form_test, params=list(\n          template=decoded_template_def$layout,\n          header=decoded_template_def$header,\n          title=registration_form$title, \n          paragraph=registration_form$paragraph,\n          footer=decoded_template_def$footer,\n          form=toJSON(\n            list(\n              list(name=\"login\", definition=list(type=\"singleline\"), label=registration_form$login_label, validation=\"login!=''\", alert=registration_form$login_alert),\n              list(name=\"password\", definition=list(type=\"password\"), label=registration_form$password_label, validation=\"password!=''\", alert=registration_form$password_alert),\n              list(name=\"password_confirmation\", definition=list(type=\"password\"), label=registration_form$password_confirmation_label, validation=\"password==password_confirmation\", alert=registration_form$password_confirmation_alert),\n              list(name=\"email\", definition=list(type=\"singleline\"), label=registration_form$email_label, validation=\"email!=''\", alert=registration_form$email_alert)\n            )\n          ),\n          warning_msg = reg_warning_msg,\n          button_label=registration_form$register_button_label\n        ));\n\n        if(!doesLoginExists(result$response$login)) {\n          break\n        } else {\n          reg_warning_msg = registration_form$login_exists_alert\n        }\n      }\n      email_confirmation_on = registration$email_confirmation == \"1\"\n      enabled = \"1\"\n      if(email_confirmation_on) { \n        enabled == \"0\" \n      }\n      uid = createNewUser(result$response$login, result$response$password, result$response$email, enabled)\n      if(email_confirmation_on) { \n        email_conf_request_page = fromJSON(email_conf_request_page)\n        email_conf = fromJSON(email_confirmation)\n        sendConfirmationMail(uid, result$response$email, registration$ec_smtp$host, registration$ec_smtp$port, email_conf$sender, email_conf$subject, email_conf$paragraph, registration$ec_link, email_conf$template)\n\n        concerto.template.show(decoded_template_def$layout, params=list(\n          header=decoded_template_def$header, \n          title=email_conf_request_page$title, \n          content=email_conf_request_page$content, \n          warning_msg=\"\", \n          buttons=\"\",\n          footer=decoded_template_def$footer\n        )) \n      }\n      user = authorizeUser(list(login=result$response$login, password=result$response$password))\n      break\n    }\n  }\n}\nif(!is.na(type) && type==\"direct\") {\n  print(\"using direct user...\")\n  user = direct_user\n}\n\nsession = NULL\nif(resume_session == \"1\") {\n  session = resumeSession(user)\n  if(!is.null(session)) {\n    print(\"resuming session...\")\n    hash = concerto.table.query(\"SELECT hash FROM TestSession WHERE id={{id}}\", list(id=session$previous_internal_id))\n    print(hash)\n    file = gsub(concerto$session$hash, hash, concerto$sessionFile)\n    if(file.exists(file)) {\n    \tconcerto.session.restoreFlow(hash)\n    } else {\n      \tprint(\"session resume file not found\")\n      \tsession = NULL\n    }\n  }\n}\nif(is.null(session)) {\n  print(\"creating new session...\")\n  session = createSession(user)\n}\nprint(\"DONE\")",
            "outdated": "0",
            "description": "",
            "variables": [
                {
                    "class_name": "TestVariable",
                    "id": 97,
                    "name": "type",
                    "type": 0,
                    "description": "<p>Authorization type<\/p>\n\n<ul>\n\t<li><strong>user table<\/strong>&nbsp;- predefined user bank that let&#39;s users log in using login\/password combination<\/li>\n<\/ul>\n",
                    "passableThroughUrl": "0",
                    "value": "table",
                    "test": 6,
                    "parentVariable": 25
                },
                {
                    "class_name": "TestVariable",
                    "id": 98,
                    "name": "user",
                    "type": 1,
                    "description": "<p>Returned user object list:<\/p>\n\n<ul>\n\t<li><strong>user$id<\/strong>&nbsp;- user unique id<\/li>\n\t<li><strong>user$login&nbsp;<\/strong>- user login<\/li>\n<\/ul>\n",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 6,
                    "parentVariable": 26
                },
                {
                    "class_name": "TestVariable",
                    "id": 99,
                    "name": "user_bank",
                    "type": 0,
                    "description": "<p style=\"line-height: 20.8px;\">User bank table type:<\/p>\n\n<ul style=\"line-height: 20.8px;\">\n\t<li><strong>default&nbsp;<\/strong>- uses default Concerto table; user needs to be inserted first<\/li>\n\t<li><strong>direct<\/strong>&nbsp;- can be defined directly in wizard form<\/li>\n\t<li><strong>custom<\/strong>&nbsp;- used to define your own table that you want to use as user bank<\/li>\n<\/ul>\n",
                    "passableThroughUrl": "0",
                    "value": "{\"table_type\":\"default\",\"direct_table\":[],\"custom_table\":[],\"custom_login_column\":[],\"custom_password_column\":[],\"custom_encryption_column\":[],\"custom_test_id_column\":[],\"data_set_id\":\"\"}",
                    "test": 6,
                    "parentVariable": 27
                },
                {
                    "class_name": "TestVariable",
                    "id": 100,
                    "name": "user_bank",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 6,
                    "parentVariable": 28
                },
                {
                    "class_name": "TestVariable",
                    "id": 101,
                    "name": "session_bank",
                    "type": 0,
                    "description": "<p>Session table definition:<\/p>\n\n<ul>\n\t<li><strong>default<\/strong>&nbsp;- uses default session table<\/li>\n\t<li><strong>custom&nbsp;<\/strong>- define your own session table<\/li>\n<\/ul>\n",
                    "passableThroughUrl": "0",
                    "value": "{\"table_type\":\"default\",\"custom_table\":[],\"custom_user_id_login\":{\"table\":null},\"custom_test_id_column\":[]}",
                    "test": 6,
                    "parentVariable": 29
                },
                {
                    "class_name": "TestVariable",
                    "id": 102,
                    "name": "session",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 6,
                    "parentVariable": 30
                },
                {
                    "class_name": "TestVariable",
                    "id": 103,
                    "name": "session_bank",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 6,
                    "parentVariable": 31
                },
                {
                    "class_name": "TestVariable",
                    "id": 104,
                    "name": "registration",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "{\"email_confirmation\":\"0\",\"ec_smtp\":[],\"form_test\":\"form\",\"ec_link\":\"http:\\\/\\\/domain.com\\\/test\\\/slug?ecuid={{ecuid}}\"}",
                    "test": 6,
                    "parentVariable": 32
                },
                {
                    "class_name": "TestVariable",
                    "id": 105,
                    "name": "ecuid",
                    "type": 0,
                    "description": "<p>Email confirmation user id<\/p>\n",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 6,
                    "parentVariable": 33
                },
                {
                    "class_name": "TestVariable",
                    "id": 106,
                    "name": "template_def",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 6,
                    "parentVariable": 34
                },
                {
                    "class_name": "TestVariable",
                    "id": 107,
                    "name": "login_form",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "{\"title\":\"DEMO TEST\",\"paragraph\":\"<p>Please log in:<\\\/p>\\n\",\"button_label\":\"log in\",\"failed_alert\":\"Authorization failed!\",\"form_field\":\"form_field\",\"form_field_input\":\"form_field_input\",\"buttons_template\":\"buttons_start_session_login\",\"login_button_label\":\"log in\",\"register_button_label\":\"register\",\"alert_template\":\"form_alert\"}",
                    "test": 6,
                    "parentVariable": 35
                },
                {
                    "class_name": "TestVariable",
                    "id": 108,
                    "name": "registration_enabled",
                    "type": 0,
                    "description": "<p>Is public registration enabled?<\/p>\n",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 6,
                    "parentVariable": 36
                },
                {
                    "class_name": "TestVariable",
                    "id": 109,
                    "name": "registration_form",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "{\"paragraph\":\"<p>Please fill the form below:<\\\/p>\\n\",\"login_label\":\"Login\",\"login_alert\":\"Invalid login!\",\"password_label\":\"Password\",\"password_alert\":\"Invalid password!\",\"password_confirmation_label\":\"Password confirmation\",\"password_confirmation_alert\":\"Password confirmation and password doesn't match!\",\"email_label\":\"Email\",\"email_alert\":\"Invalid email!\",\"register_button_label\":\"register\",\"login_exists_alert\":\"Login already exists!\",\"title\":\"REGISTRATION\"}",
                    "test": 6,
                    "parentVariable": 37
                },
                {
                    "class_name": "TestVariable",
                    "id": 110,
                    "name": "email_conf_request_page",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "{\"title\":\"EMAIL CONFIRMATION\",\"content\":\"<p>Email has been sent to your address. Please follow the link in the email to confirm your address.<\\\/p>\\n\"}",
                    "test": 6,
                    "parentVariable": 38
                },
                {
                    "class_name": "TestVariable",
                    "id": 111,
                    "name": "email_conf_success_page",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "{\"title\":\"EMAIL CONFIRMATION\",\"content\":\"<p>Your email address has been successfully verified. Please refresh the page to log in.<\\\/p>\\n\"}",
                    "test": 6,
                    "parentVariable": 39
                },
                {
                    "class_name": "TestVariable",
                    "id": 112,
                    "name": "email_confirmation",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "{\"sender\":\"concerto@domain.com\",\"subject\":\"email confirmation\",\"paragraph\":\"<p>To verify your email address please click <a href=\\\"{{url}}\\\">HERE<\\\/a>.<\\\/p>\\n\",\"template\":\"start_session_confirmation_mail\"}",
                    "test": 6,
                    "parentVariable": 40
                },
                {
                    "class_name": "TestVariable",
                    "id": 113,
                    "name": "direct_user",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 6,
                    "parentVariable": 43
                },
                {
                    "class_name": "TestVariable",
                    "id": 114,
                    "name": "resume_session_time_limit",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 6,
                    "parentVariable": 44
                },
                {
                    "class_name": "TestVariable",
                    "id": 115,
                    "name": "resume_session",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 6,
                    "parentVariable": 42
                },
                {
                    "class_name": "TestVariable",
                    "id": 116,
                    "name": "new_session",
                    "type": 2,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 6,
                    "parentVariable": 41
                }
            ],
            "sourceWizard": 3,
            "sourceWizardName": "start_session",
            "sourceWizardTest": 3,
            "sourceWizardTestName": "source_start_session",
            "updatedOn": "2018-05-16 18:17:09",
            "updatedBy": "admin",
            "nodes": [],
            "nodesConnections": [],
            "tags": "_concerto_core",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "86246b169f65c5c136ef458290c44503be5e6635"
        },
        {
            "class_name": "Test",
            "id": 7,
            "name": "source_form",
            "accessibility": 2,
            "archived": "0",
            "visibility": 2,
            "type": 0,
            "code": "if(is.null(template_def) || is.na(template_def) || template_def == \"\") {\n  decoded_template_def = fromJSON(concerto.var.get(\"template_def\"))\n} else {\n  decoded_template_def = fromJSON(template_def)\n}\n\nisValid = function(type, value, condition, form, response) {\n  valid = T\n  if(!is.null(response)) {\n    env_vld = new.env()\n    if(length(form) > 0) {\n      for(i in 1:length(form)) {\n        v = response[[form[[i]]$name]]\n        assign(form[[i]]$name, v, envir=env_vld)\n      }\n    }\n\n    res = try(eval(parse(text=condition), envir=env_vld), T)\n    if(!is.null(res) && res == T) {\n      valid = T\n    }\n    if(!is.null(res) && res == F) {\n      valid = F\n    }\n  }\n  return(valid)\n}\n\ngetContent = function(paragraph, form, response) {\n  content = paragraph\n  if(length(form) > 0) {\n    for(i in 1:length(form)) {\n      type = form[[i]]$definition$type\n      value = response[[form[[i]]$name]]\n      if(is.null(value)) {\n        value = form[[i]]$default\n      }\n      if(is.null(value)) {\n        value = \"\"\n      }\n      condition = form[[i]]$validation\n      valid = isValid(type, value, condition, form, response)\n      id = paste0(\"form\",i)\n      name = form[[i]]$name\n      label = form[[i]]$label\n      control = \"\"\n\n      if(type == \"custom\") {\n        control = concerto.template.join(templateId=form[[i]]$definition$custom_template,params=list(id=id,name=name,value=value)) \n      } else if(type == \"singleline\") {\n        control = concerto.template.join(templateId=form_field_input_template,params=list(id=id,name=name,type=\"text\",value=value))\n      } else if(type == \"password\") {\n        control = concerto.template.join(templateId=form_field_input_template,params=list(id=id,name=name,type=\"password\",value=value))\n      } else if(type == \"date\") {\n        control = concerto.template.join(templateId=form_field_input_template,params=list(id=id,name=name,type=\"date\",value=value))\n      } else if(type == \"multiline\") {\n        control = concerto.template.join(templateId=form_field_multiline_template,params=list(id=id,name=name,value=value))\n      } else if(type == \"file\") {\n        control = concerto.template.join(templateId=form_field_file_template,params=list(id=id,name=name))\n      } else if(type == \"select\") {\n        control = concerto.template.join(templateId=form_field_select_template,params=list(id=id,name=name,options=toJSON(form[[i]]$definition$select_options),value=value))\n      } else if(type == \"checkbox\") {\n        checked = \"\"\n        if(value==\"1\") {\n          checked = \"checked\"\n        }\n        control = concerto.template.join(templateId=form_field_checkbox_template,params=list(id=id,name=name,attrs=checked))\n      } else if(type == \"slider\") {\n        if(value == \"\") {\n          value = \"null\";\n        }\n        control = concerto.template.join(templateId=form_field_slider_template,params=list(id=id,name=name,value=value,definition=toJSON(form[[i]]$definition)))\n      }\n        classes = \"\"\n        if(!is.null(response) && !valid) {\n          classes = \"validationHighlight\"\n        }\n        field = concerto.template.join(templateId=form_field_template,params=list(id=id,label=label,classes=classes,control=control))\n        content = paste0(content, field)\n        }\n        }\n        return(content)\n        }\n\n        getAlert = function(form, response) {\n          alert = NULL\n          if(response$buttonPressed != \"submit\") {\n            return(alert)\n          }\n\n          if(length(form) > 0) {\n            for(i in 1:length(form)) {\n              type = form[[i]]$definition$type\n              value = response[[form[[i]]$name]]\n              condition = form[[i]]$validation\n              valid = isValid(type, value, condition, form, response)\n\n              validationHighlight = \"\"\n              if(!is.null(response) && !valid) {\n                alert = paste0(alert,concerto.template.join(templateId=form_alert_template,params=list(alert=form[[i]]$alert)))\n              }\n            }\n          }\n          return(alert)\n        }\n\n        getTemplateParams = function(template_params){\n          params = list()\n          if(!is.null(inserts) && is.list(inserts)) {\n            params = inserts\n          }\n          for(key in ls(template_params)) {\n            params[[key]] = template_params[[key]]\n          }\n          return(params)\n        }\n\n        cb1 = fromJSON(custom_button_1)\n        buttons = concerto.template.join(templateId=buttons_template,params=list(\n          label=button_label,\n          cb1_enabled=cb1$enabled,\n          cb1_label=cb1$label\n        ))\n\n        content = paragraph\n        form = fromJSON(form)\n\n        if(!is.null(warning_msg) && (is.na(warning_msg) || warning_msg == \"\")) {\n          warning_msg = \"\"\n        }\n\n        response = NULL\n        while(T) {\n          content = getContent(paragraph, form, response)\n          response = concerto.template.show(decoded_template_def$layout, params=getTemplateParams(list(\n            header=decoded_template_def$header, \n            title=title,\n            content=content, \n            warning_msg=warning_msg, \n            buttons=buttons,\n            footer=decoded_template_def$footer\n          )))\n          warning_msg = getAlert(form, response)\n          if(is.null(warning_msg) || warning_msg == \"\") { break }\n        }\n\n        if(response$buttonPressed == \"submit\") {\n          .branch = \"submit\"\n        } else if(response$buttonPressed == \"custom_button_1\") {\n          .branch = \"custom_button_1\"\n        }",
            "outdated": "0",
            "description": "",
            "variables": [
                {
                    "class_name": "TestVariable",
                    "id": 117,
                    "name": "submit",
                    "type": 2,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 118,
                    "name": "form",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 119,
                    "name": "button_label",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 120,
                    "name": "paragraph",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 121,
                    "name": "response",
                    "type": 1,
                    "description": "<p><span style=\"line-height: 20.8px;\">Submitted user response R list object<\/span><\/p>",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 122,
                    "name": "inserts",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 123,
                    "name": "warning_msg",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 124,
                    "name": "title",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 125,
                    "name": "template_def",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 126,
                    "name": "form_field_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 127,
                    "name": "form_field_input_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 128,
                    "name": "form_field_multiline_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 129,
                    "name": "form_field_select_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 130,
                    "name": "form_field_checkbox_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 131,
                    "name": "form_field_slider_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 132,
                    "name": "form_alert_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 133,
                    "name": "buttons_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 134,
                    "name": "form_field_file_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 135,
                    "name": "custom_button_1",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 136,
                    "name": "custom_button_1",
                    "type": 2,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 137,
                    "name": ".branch",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 7,
                    "parentVariable": null
                }
            ],
            "sourceWizard": null,
            "sourceWizardName": null,
            "sourceWizardTest": null,
            "sourceWizardTestName": null,
            "updatedOn": "2018-05-16 18:17:08",
            "updatedBy": "",
            "nodes": [],
            "nodesConnections": [],
            "tags": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "1b8ddf8bfc517984bb9923275f93d4b48500bc38"
        },
        {
            "class_name": "TestWizard",
            "id": 4,
            "name": "form",
            "description": "",
            "accessibility": 2,
            "archived": "0",
            "steps": [
                {
                    "class_name": "TestWizardStep",
                    "id": 10,
                    "title": "Presentation",
                    "description": "<p>Visual presentation of form page<\/p>\n",
                    "orderNum": 0,
                    "colsNum": 0,
                    "wizard": 4,
                    "params": [
                        {
                            "class_name": "TestWizardParam",
                            "id": 32,
                            "label": "Submit button label",
                            "description": "<p>Submit button label<\/p>\n",
                            "hideCondition": "",
                            "type": 0,
                            "passableThroughUrl": "0",
                            "value": "Submit",
                            "testVariable": 119,
                            "name": "button_label",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 4,
                            "wizard": 4,
                            "definition": {
                                "placeholder": "0",
                                "defvalue": "Submit"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 33,
                            "label": "Paragraph",
                            "description": "<p>Form page paragraph<\/p>\n",
                            "hideCondition": "",
                            "type": 2,
                            "passableThroughUrl": "0",
                            "value": "",
                            "testVariable": 120,
                            "name": "paragraph",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 2,
                            "wizard": 4,
                            "definition": {
                                "placeholder": "0"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 34,
                            "label": "Title",
                            "description": "",
                            "hideCondition": "",
                            "type": 0,
                            "passableThroughUrl": "0",
                            "value": "Page Title e.g. Demographics",
                            "testVariable": 124,
                            "name": "title",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 1,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 35,
                            "label": "Form field template",
                            "description": "",
                            "hideCondition": "",
                            "type": 5,
                            "passableThroughUrl": "0",
                            "value": "form_field",
                            "testVariable": 126,
                            "name": "form_field_template",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 0,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "form_field"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 36,
                            "label": "Form alert template",
                            "description": "",
                            "hideCondition": "",
                            "type": 5,
                            "passableThroughUrl": "0",
                            "value": "form_alert",
                            "testVariable": 132,
                            "name": "form_alert_template",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 0,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "form_alert"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 37,
                            "label": "Form field checkbox template",
                            "description": "",
                            "hideCondition": "",
                            "type": 5,
                            "passableThroughUrl": "0",
                            "value": "form_field_checkbox",
                            "testVariable": 130,
                            "name": "form_field_checkbox_template",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 0,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "form_field_checkbox"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 38,
                            "label": "Form field file tmplate",
                            "description": "",
                            "hideCondition": "",
                            "type": 5,
                            "passableThroughUrl": "0",
                            "value": "form_field_file",
                            "testVariable": 134,
                            "name": "form_field_file_template",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 0,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "form_field_file"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 39,
                            "label": "Form field input template",
                            "description": "",
                            "hideCondition": "",
                            "type": 5,
                            "passableThroughUrl": "0",
                            "value": "form_field_input",
                            "testVariable": 127,
                            "name": "form_field_input_template",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 0,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "form_field_input"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 40,
                            "label": "Form field multiline template",
                            "description": "",
                            "hideCondition": "",
                            "type": 5,
                            "passableThroughUrl": "0",
                            "value": "form_field_multiline",
                            "testVariable": 128,
                            "name": "form_field_multiline_template",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 0,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "form_field_multiline"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 41,
                            "label": "Form field select template",
                            "description": "",
                            "hideCondition": "",
                            "type": 5,
                            "passableThroughUrl": "0",
                            "value": "form_field_select",
                            "testVariable": 129,
                            "name": "form_field_select_template",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 0,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "form_field_select"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 42,
                            "label": "Form field slider template",
                            "description": "",
                            "hideCondition": "",
                            "type": 5,
                            "passableThroughUrl": "0",
                            "value": "form_field_slider",
                            "testVariable": 131,
                            "name": "form_field_slider_template",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 0,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "form_field_slider"
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 43,
                            "label": "Custom button #1",
                            "description": "",
                            "hideCondition": "",
                            "type": 9,
                            "passableThroughUrl": "0",
                            "value": "{\"enabled\":\"0\",\"label\":null}",
                            "testVariable": 135,
                            "name": "custom_button_1",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 5,
                            "wizard": 4,
                            "definition": {
                                "fields": [
                                    {
                                        "type": 4,
                                        "name": "enabled",
                                        "label": "Enabled",
                                        "definition": {
                                            "placeholder": 0
                                        }
                                    },
                                    {
                                        "type": 0,
                                        "name": "label",
                                        "label": "Label",
                                        "definition": {
                                            "placeholder": 0
                                        },
                                        "hideCondition": "parent.enabled == \"0\""
                                    }
                                ]
                            }
                        },
                        {
                            "class_name": "TestWizardParam",
                            "id": 44,
                            "label": "Buttons template",
                            "description": "",
                            "hideCondition": "",
                            "type": 5,
                            "passableThroughUrl": "0",
                            "value": "buttons_multiple",
                            "testVariable": 133,
                            "name": "buttons_template",
                            "wizardStep": 10,
                            "stepTitle": "Presentation",
                            "order": 3,
                            "wizard": 4,
                            "definition": {
                                "placeholder": 0,
                                "defvalue": "buttons_multiple"
                            }
                        }
                    ]
                },
                {
                    "class_name": "TestWizardStep",
                    "id": 11,
                    "title": "Forms",
                    "description": "<p>Forms declaration<\/p>\n",
                    "orderNum": 1,
                    "colsNum": 0,
                    "wizard": 4,
                    "params": [
                        {
                            "class_name": "TestWizardParam",
                            "id": 45,
                            "label": "Form fields",
                            "description": "<p>Form fields list<\/p>\n",
                            "hideCondition": "",
                            "type": 10,
                            "passableThroughUrl": "0",
                            "value": "[]",
                            "testVariable": 118,
                            "name": "form",
                            "wizardStep": 11,
                            "stepTitle": "Forms",
                            "order": 0,
                            "wizard": 4,
                            "definition": {
                                "placeholder": "0",
                                "element": {
                                    "type": 9,
                                    "definition": {
                                        "placeholder": "0",
                                        "fields": [
                                            {
                                                "type": "0",
                                                "name": "name",
                                                "label": "Name",
                                                "definition": {
                                                    "placeholder": "0"
                                                }
                                            },
                                            {
                                                "type": "0",
                                                "name": "label",
                                                "label": "Label",
                                                "definition": {
                                                    "placeholder": "0"
                                                }
                                            },
                                            {
                                                "type": 0,
                                                "name": "validation",
                                                "label": "Validation",
                                                "definition": {
                                                    "placeholder": "0"
                                                }
                                            },
                                            {
                                                "type": "0",
                                                "name": "alert",
                                                "label": "Validation alert",
                                                "hideCondition": "parent.validation == \"\"",
                                                "definition": {
                                                    "placeholder": "0"
                                                }
                                            },
                                            {
                                                "type": 0,
                                                "name": "default",
                                                "label": "Default value",
                                                "definition": {
                                                    "placeholder": 0
                                                }
                                            },
                                            {
                                                "type": 9,
                                                "name": "definition",
                                                "label": "Definition",
                                                "definition": {
                                                    "placeholder": 0,
                                                    "fields": [
                                                        {
                                                            "type": 10,
                                                            "name": "select_options",
                                                            "label": "Options",
                                                            "definition": {
                                                                "placeholder": 0,
                                                                "element": {
                                                                    "type": 9,
                                                                    "definition": {
                                                                        "placeholder": 0,
                                                                        "fields": [
                                                                            {
                                                                                "type": 0,
                                                                                "name": "value",
                                                                                "label": "Value",
                                                                                "definition": {
                                                                                    "placeholder": 0
                                                                                }
                                                                            },
                                                                            {
                                                                                "type": 0,
                                                                                "name": "label",
                                                                                "label": "Label",
                                                                                "definition": {
                                                                                    "placeholder": 0
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                }
                                                            },
                                                            "hideCondition": "parent.type != \"select\"",
                                                            "order": 1
                                                        },
                                                        {
                                                            "type": 0,
                                                            "name": "min",
                                                            "label": "Min value",
                                                            "definition": {
                                                                "placeholder": 0
                                                            },
                                                            "hideCondition": "parent.type != \"slider\"",
                                                            "order": 2
                                                        },
                                                        {
                                                            "type": 0,
                                                            "name": "max",
                                                            "label": "Max value",
                                                            "definition": {
                                                                "placeholder": 0
                                                            },
                                                            "hideCondition": "parent.type != \"slider\"",
                                                            "order": 3
                                                        },
                                                        {
                                                            "type": 0,
                                                            "name": "step",
                                                            "label": "Step",
                                                            "definition": {
                                                                "placeholder": 0
                                                            },
                                                            "hideCondition": "parent.type != \"slider\"",
                                                            "order": 4
                                                        },
                                                        {
                                                            "type": 0,
                                                            "name": "label_extreme_left",
                                                            "label": "Left extreme label",
                                                            "definition": {
                                                                "placeholder": 0
                                                            },
                                                            "hideCondition": "parent.type != \"slider\"",
                                                            "order": 5
                                                        },
                                                        {
                                                            "type": 0,
                                                            "name": "label_extreme_right",
                                                            "label": "Right extreme label",
                                                            "definition": {
                                                                "placeholder": 0
                                                            },
                                                            "hideCondition": "parent.type != \"slider\"",
                                                            "order": 6
                                                        },
                                                        {
                                                            "type": 3,
                                                            "name": "type",
                                                            "label": "Type",
                                                            "definition": {
                                                                "placeholder": 0,
                                                                "options": [
                                                                    {
                                                                        "value": "singleline",
                                                                        "label": "Single line",
                                                                        "order": 6
                                                                    },
                                                                    {
                                                                        "value": "multiline",
                                                                        "label": "Multi line",
                                                                        "order": 3
                                                                    },
                                                                    {
                                                                        "value": "select",
                                                                        "label": "Drop-down list",
                                                                        "order": 5
                                                                    },
                                                                    {
                                                                        "value": "checkbox",
                                                                        "label": "Checkbox",
                                                                        "order": 0
                                                                    },
                                                                    {
                                                                        "value": "password",
                                                                        "label": "Password",
                                                                        "order": 4
                                                                    },
                                                                    {
                                                                        "value": "slider",
                                                                        "label": "Slider",
                                                                        "order": 7
                                                                    },
                                                                    {
                                                                        "value": "file",
                                                                        "label": "File",
                                                                        "order": 2
                                                                    },
                                                                    {
                                                                        "value": "date",
                                                                        "label": "Date",
                                                                        "order": 1
                                                                    },
                                                                    {
                                                                        "value": "custom",
                                                                        "label": "Custom",
                                                                        "order": 8
                                                                    }
                                                                ],
                                                                "defvalue": "singleline"
                                                            },
                                                            "order": 0
                                                        },
                                                        {
                                                            "type": 4,
                                                            "name": "hide_number",
                                                            "label": "Hide Slider Number?",
                                                            "definition": {
                                                                "placeholder": 0
                                                            },
                                                            "order": 7,
                                                            "hideCondition": "parent.type != \"slider\""
                                                        },
                                                        {
                                                            "type": 0,
                                                            "name": "prefix_text",
                                                            "label": "Prefix text for number, e.g. \"$\" (optional)",
                                                            "definition": {
                                                                "placeholder": 0
                                                            },
                                                            "hideCondition": "parent.type != \"slider\" || parent.hide_number == \"1\"",
                                                            "order": 8
                                                        },
                                                        {
                                                            "type": 0,
                                                            "name": "suffix_text",
                                                            "label": "Suffix text for number, e.g. \" USD\" - note the extra space (optional)",
                                                            "definition": {
                                                                "placeholder": 0
                                                            },
                                                            "hideCondition": "parent.type != \"slider\" || parent.hide_number == \"1\"",
                                                            "order": 9
                                                        },
                                                        {
                                                            "type": 5,
                                                            "name": "custom_template",
                                                            "label": "Custom field template",
                                                            "definition": {
                                                                "placeholder": 0
                                                            },
                                                            "hideCondition": "parent.type != \"custom\"",
                                                            "order": 10
                                                        }
                                                    ]
                                                },
                                                "hideCondition": ""
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    ]
                }
            ],
            "test": 7,
            "testName": "source_form",
            "updatedOn": "2018-05-16 18:17:08",
            "updatedBy": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "bba256eea6b039a018f0291b7fb1d94f1944ecf8"
        },
        {
            "class_name": "Test",
            "id": 8,
            "name": "form",
            "accessibility": 2,
            "archived": "0",
            "visibility": 2,
            "type": 1,
            "code": "if(is.null(template_def) || is.na(template_def) || template_def == \"\") {\n  decoded_template_def = fromJSON(concerto.var.get(\"template_def\"))\n} else {\n  decoded_template_def = fromJSON(template_def)\n}\n\nisValid = function(type, value, condition, form, response) {\n  valid = T\n  if(!is.null(response)) {\n    env_vld = new.env()\n    if(length(form) > 0) {\n      for(i in 1:length(form)) {\n        v = response[[form[[i]]$name]]\n        assign(form[[i]]$name, v, envir=env_vld)\n      }\n    }\n\n    res = try(eval(parse(text=condition), envir=env_vld), T)\n    if(!is.null(res) && res == T) {\n      valid = T\n    }\n    if(!is.null(res) && res == F) {\n      valid = F\n    }\n  }\n  return(valid)\n}\n\ngetContent = function(paragraph, form, response) {\n  content = paragraph\n  if(length(form) > 0) {\n    for(i in 1:length(form)) {\n      type = form[[i]]$definition$type\n      value = response[[form[[i]]$name]]\n      if(is.null(value)) {\n        value = form[[i]]$default\n      }\n      if(is.null(value)) {\n        value = \"\"\n      }\n      condition = form[[i]]$validation\n      valid = isValid(type, value, condition, form, response)\n      id = paste0(\"form\",i)\n      name = form[[i]]$name\n      label = form[[i]]$label\n      control = \"\"\n\n      if(type == \"custom\") {\n        control = concerto.template.join(templateId=form[[i]]$definition$custom_template,params=list(id=id,name=name,value=value)) \n      } else if(type == \"singleline\") {\n        control = concerto.template.join(templateId=form_field_input_template,params=list(id=id,name=name,type=\"text\",value=value))\n      } else if(type == \"password\") {\n        control = concerto.template.join(templateId=form_field_input_template,params=list(id=id,name=name,type=\"password\",value=value))\n      } else if(type == \"date\") {\n        control = concerto.template.join(templateId=form_field_input_template,params=list(id=id,name=name,type=\"date\",value=value))\n      } else if(type == \"multiline\") {\n        control = concerto.template.join(templateId=form_field_multiline_template,params=list(id=id,name=name,value=value))\n      } else if(type == \"file\") {\n        control = concerto.template.join(templateId=form_field_file_template,params=list(id=id,name=name))\n      } else if(type == \"select\") {\n        control = concerto.template.join(templateId=form_field_select_template,params=list(id=id,name=name,options=toJSON(form[[i]]$definition$select_options),value=value))\n      } else if(type == \"checkbox\") {\n        checked = \"\"\n        if(value==\"1\") {\n          checked = \"checked\"\n        }\n        control = concerto.template.join(templateId=form_field_checkbox_template,params=list(id=id,name=name,attrs=checked))\n      } else if(type == \"slider\") {\n        if(value == \"\") {\n          value = \"null\";\n        }\n        control = concerto.template.join(templateId=form_field_slider_template,params=list(id=id,name=name,value=value,definition=toJSON(form[[i]]$definition)))\n      }\n        classes = \"\"\n        if(!is.null(response) && !valid) {\n          classes = \"validationHighlight\"\n        }\n        field = concerto.template.join(templateId=form_field_template,params=list(id=id,label=label,classes=classes,control=control))\n        content = paste0(content, field)\n        }\n        }\n        return(content)\n        }\n\n        getAlert = function(form, response) {\n          alert = NULL\n          if(response$buttonPressed != \"submit\") {\n            return(alert)\n          }\n\n          if(length(form) > 0) {\n            for(i in 1:length(form)) {\n              type = form[[i]]$definition$type\n              value = response[[form[[i]]$name]]\n              condition = form[[i]]$validation\n              valid = isValid(type, value, condition, form, response)\n\n              validationHighlight = \"\"\n              if(!is.null(response) && !valid) {\n                alert = paste0(alert,concerto.template.join(templateId=form_alert_template,params=list(alert=form[[i]]$alert)))\n              }\n            }\n          }\n          return(alert)\n        }\n\n        getTemplateParams = function(template_params){\n          params = list()\n          if(!is.null(inserts) && is.list(inserts)) {\n            params = inserts\n          }\n          for(key in ls(template_params)) {\n            params[[key]] = template_params[[key]]\n          }\n          return(params)\n        }\n\n        cb1 = fromJSON(custom_button_1)\n        buttons = concerto.template.join(templateId=buttons_template,params=list(\n          label=button_label,\n          cb1_enabled=cb1$enabled,\n          cb1_label=cb1$label\n        ))\n\n        content = paragraph\n        form = fromJSON(form)\n\n        if(!is.null(warning_msg) && (is.na(warning_msg) || warning_msg == \"\")) {\n          warning_msg = \"\"\n        }\n\n        response = NULL\n        while(T) {\n          content = getContent(paragraph, form, response)\n          response = concerto.template.show(decoded_template_def$layout, params=getTemplateParams(list(\n            header=decoded_template_def$header, \n            title=title,\n            content=content, \n            warning_msg=warning_msg, \n            buttons=buttons,\n            footer=decoded_template_def$footer\n          )))\n          warning_msg = getAlert(form, response)\n          if(is.null(warning_msg) || warning_msg == \"\") { break }\n        }\n\n        if(response$buttonPressed == \"submit\") {\n          .branch = \"submit\"\n        } else if(response$buttonPressed == \"custom_button_1\") {\n          .branch = \"custom_button_1\"\n        }",
            "outdated": "0",
            "description": "",
            "variables": [
                {
                    "class_name": "TestVariable",
                    "id": 138,
                    "name": "form",
                    "type": 0,
                    "description": "<p>Form fields list<\/p>\n",
                    "passableThroughUrl": "0",
                    "value": "[{\"name\":\"age\",\"label\":\"How old are you?\",\"validation\":\"age != \\\"\\\"\",\"alert\":\"Please enter your age\",\"default\":\"\",\"definition\":{\"type\":\"singleline\",\"select_options\":[],\"min\":\"\",\"max\":\"\",\"step\":\"\",\"label_extreme_left\":\"\",\"label_extreme_right\":\"\",\"hide_number\":\"0\",\"prefix_text\":\"\",\"suffix_text\":\"\",\"custom_template\":\"\"}},{\"name\":\"gender\",\"label\":\"What is your gender?\",\"validation\":\"gender != \\\"none\\\"\",\"alert\":\"Please select your gender\",\"default\":\"\",\"definition\":{\"type\":\"select\",\"select_options\":[{\"value\":\"none\",\"label\":\"\"},{\"value\":\"male\",\"label\":\"Male\"},{\"value\":\"female\",\"label\":\"Female\"}],\"min\":\"\",\"max\":\"\",\"step\":\"\",\"label_extreme_left\":\"\",\"label_extreme_right\":\"\",\"hide_number\":\"0\",\"prefix_text\":\"\",\"suffix_text\":\"\",\"custom_template\":\"\"}},{\"name\":\"email_address\",\"label\":\"What is your email address?\",\"validation\":\"grepl(\\\"\\\\\\\\<[A-Z0-9._%+-]+@[A-Z0-9.-]+\\\\\\\\.[A-Z]{2,}\\\\\\\\>\\\", as.character(email_address), ignore.case=TRUE)\",\"alert\":\"Please enter a valid email address\",\"default\":\"\",\"definition\":{\"type\":\"singleline\",\"select_options\":[],\"min\":\"\",\"max\":\"\",\"step\":\"\",\"label_extreme_left\":\"\",\"label_extreme_right\":\"\",\"hide_number\":\"0\",\"prefix_text\":\"\",\"suffix_text\":\"\",\"custom_template\":\"\"}}]",
                    "test": 8,
                    "parentVariable": 118
                },
                {
                    "class_name": "TestVariable",
                    "id": 139,
                    "name": "button_label",
                    "type": 0,
                    "description": "<p>Continue button label<\/p>\n",
                    "passableThroughUrl": "0",
                    "value": "Submit",
                    "test": 8,
                    "parentVariable": 119
                },
                {
                    "class_name": "TestVariable",
                    "id": 140,
                    "name": "paragraph",
                    "type": 0,
                    "description": "<p>Form page paragraph<\/p>\n",
                    "passableThroughUrl": "0",
                    "value": "<p>Please answer the questions below:<\/p>\n",
                    "test": 8,
                    "parentVariable": 120
                },
                {
                    "class_name": "TestVariable",
                    "id": 141,
                    "name": "response",
                    "type": 1,
                    "description": "<p><span style=\"line-height: 20.8px;\">Submitted user response R list object<\/span><\/p>",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 8,
                    "parentVariable": 121
                },
                {
                    "class_name": "TestVariable",
                    "id": 142,
                    "name": "inserts",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 8,
                    "parentVariable": 122
                },
                {
                    "class_name": "TestVariable",
                    "id": 143,
                    "name": "warning_msg",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 8,
                    "parentVariable": 123
                },
                {
                    "class_name": "TestVariable",
                    "id": 144,
                    "name": "title",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "Page Title e.g. Demographics",
                    "test": 8,
                    "parentVariable": 124
                },
                {
                    "class_name": "TestVariable",
                    "id": 145,
                    "name": "template_def",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 8,
                    "parentVariable": 125
                },
                {
                    "class_name": "TestVariable",
                    "id": 146,
                    "name": "form_field_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "form_field",
                    "test": 8,
                    "parentVariable": 126
                },
                {
                    "class_name": "TestVariable",
                    "id": 147,
                    "name": "form_field_input_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "form_field_input",
                    "test": 8,
                    "parentVariable": 127
                },
                {
                    "class_name": "TestVariable",
                    "id": 148,
                    "name": "form_field_multiline_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "form_field_multiline",
                    "test": 8,
                    "parentVariable": 128
                },
                {
                    "class_name": "TestVariable",
                    "id": 149,
                    "name": "form_field_select_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "form_field_select",
                    "test": 8,
                    "parentVariable": 129
                },
                {
                    "class_name": "TestVariable",
                    "id": 150,
                    "name": "form_field_checkbox_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "form_field_checkbox",
                    "test": 8,
                    "parentVariable": 130
                },
                {
                    "class_name": "TestVariable",
                    "id": 151,
                    "name": "form_field_slider_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "form_field_slider",
                    "test": 8,
                    "parentVariable": 131
                },
                {
                    "class_name": "TestVariable",
                    "id": 152,
                    "name": "form_alert_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "form_alert",
                    "test": 8,
                    "parentVariable": 132
                },
                {
                    "class_name": "TestVariable",
                    "id": 153,
                    "name": "buttons_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "buttons_multiple",
                    "test": 8,
                    "parentVariable": 133
                },
                {
                    "class_name": "TestVariable",
                    "id": 154,
                    "name": "submit",
                    "type": 2,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 8,
                    "parentVariable": 117
                },
                {
                    "class_name": "TestVariable",
                    "id": 155,
                    "name": "form_field_file_template",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "form_field_file",
                    "test": 8,
                    "parentVariable": 134
                },
                {
                    "class_name": "TestVariable",
                    "id": 156,
                    "name": "custom_button_1",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "{\"enabled\":\"0\",\"label\":null}",
                    "test": 8,
                    "parentVariable": 135
                },
                {
                    "class_name": "TestVariable",
                    "id": 157,
                    "name": "custom_button_1",
                    "type": 2,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 8,
                    "parentVariable": 136
                },
                {
                    "class_name": "TestVariable",
                    "id": 158,
                    "name": ".branch",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 8,
                    "parentVariable": 137
                }
            ],
            "sourceWizard": 4,
            "sourceWizardName": "form",
            "sourceWizardTest": 7,
            "sourceWizardTestName": "source_form",
            "updatedOn": "2018-05-16 18:17:12",
            "updatedBy": "admin",
            "nodes": [],
            "nodesConnections": [],
            "tags": "_concerto_core",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "9ef73396749d3f42ed370d172a07257add479dd8"
        },
        {
            "class_name": "ViewTemplate",
            "id": 5,
            "name": "form_field",
            "description": "",
            "accessibility": 2,
            "archived": "0",
            "head": "",
            "css": ".form-field {\n  padding-bottom: 10px;\n}",
            "js": "",
            "html": "<div class=\"form-field {{classes}}\"><label for=\"{{id}}\">{{label}}<\/label><br \/>\n{{control}}<\/div>\n",
            "updatedOn": "2018-05-16 18:17:08",
            "updatedBy": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "53f4f079e9235798bede0fb4fce8236053357f91"
        },
        {
            "class_name": "ViewTemplate",
            "id": 6,
            "name": "form_field_input",
            "description": "",
            "accessibility": 2,
            "archived": "0",
            "head": "",
            "css": "",
            "js": "",
            "html": "<input id=\"{{id}}\" name=\"{{name}}\" type=\"{{type}}\" value=\"{{value}}\" \/>",
            "updatedOn": "2018-05-16 18:17:08",
            "updatedBy": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "c522916420e194b17eff1caae92101586dcaf002"
        },
        {
            "class_name": "ViewTemplate",
            "id": 7,
            "name": "buttons_start_session_login",
            "description": "",
            "accessibility": 2,
            "archived": "0",
            "head": "",
            "css": ".button-group {\n  width: 100%;\n  display: table;\n  table-layout: fixed;\n}\n.button-group ul {\n  display: table-row;\n}\n.button-group button {\n  background-color: #b9d979;\n  border: 0 none;\n  color: #000000;\n  font-family: \"Roboto\";\n  font-size: 1.1em;\n  font-style: normal;\n  font-weight: 500;\n  padding: 7px;\n  width: 150px;\n  cursor: pointer;\n}\n.button-group li {\n  display: table-cell;\n  text-align: center;\n  padding: 5px;\n}",
            "js": "",
            "html": "<div class=\"button-group\">\n<ul>\n\t<li><button name=\"login\">{{label_login}}<\/button><\/li>\n\t<li><button name=\"register\" ng-show=\"{{show_register}}\">{{label_register}}<\/button><\/li>\n<\/ul>\n<\/div>\n",
            "updatedOn": "2018-05-16 18:17:08",
            "updatedBy": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "01aa88fea8a8bef94e86c73fe0551f7b168d8240"
        },
        {
            "class_name": "ViewTemplate",
            "id": 8,
            "name": "form_alert",
            "description": "",
            "accessibility": 2,
            "archived": "0",
            "head": "",
            "css": "",
            "js": "",
            "html": "<div>{{alert}}<\/div>",
            "updatedOn": "2018-05-16 18:17:08",
            "updatedBy": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "65136639c5d390963f0fb08f46f04678b5cf01b7"
        },
        {
            "class_name": "ViewTemplate",
            "id": 9,
            "name": "start_session_confirmation_mail",
            "description": "",
            "accessibility": 2,
            "archived": "0",
            "head": "",
            "css": "",
            "js": "",
            "html": "{{paragraph}}\n<p><a href=\"{{url}}\">{{url}}<\/a><\/p>",
            "updatedOn": "2018-05-16 18:17:08",
            "updatedBy": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "de6cd499fcd49e4243b12541e8bbbf52b3d307ef"
        }
    ]
}